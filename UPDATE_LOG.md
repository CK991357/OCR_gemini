
# 更新日志：AI 智能编辑功能

**版本:** 1.0.0
**日期:** 2025-09-04

本次重大更新为应用添加了全新的“AI 智能编辑”功能，允许用户通过绘制蒙版和输入文本指令，对图片的特定区域进行精准的AI修改。

---

## 1. 新增功能：AI 智能编辑

-   **区域编辑**: 用户可以上传一张图片，使用可调节大小的**画笔**在图片上绘制蒙版，指定需要编辑的区域。
-   **橡皮擦工具**: 提供**橡皮擦**工具，用于精确修改蒙版区域。
-   **文本指令**: 用户可以输入自然的文本指令（例如，“把天空变成金色”或“给这个人戴上墨镜”），AI将根据指令和蒙版区域对图片进行修改。
-   **交互式画布**:
    -   基于 `Konva.js` 库构建，提供了流畅的绘制体验。
    -   支持画布的**缩放**和**平移**，方便处理大图或细节区域。
    -   画布和工具栏状态实时同步，用户体验友好（例如，无图时禁用工具）。

## 2. 架构与文件结构变更

为了保持代码的整洁和可维护性，新功能采用了模块化的架构：

-   **新建 `editor/` 目录**: 所有与AI智能编辑功能相关的逻辑都被封装在这个目录中。
    -   `editor/editor.js`: 作为功能的**主控制器**，负责处理UI事件、协调其他模块。
    -   `editor/canvas.js`: **画布模块**，封装了所有与 `Konva.js` 相关的操作，包括图片加载、绘制、缩放、平移以及导出图像和蒙版。
    -   `editor/api.js`: **API通信模块**，负责将处理好的数据（原图、蒙版、指令）发送到后端API端点。
    -   `editor/ui.js`: (已创建但当前为空) 为未来可能的复杂UI逻辑预留。

-   **`index.html` 更新**:
    -   添加了新的“AI智能编辑”功能切换按钮和对应的面板 (`#imageEditPanel`)。
    -   在主页面引入了 `Konva.js` 库的CDN链接。
    -   通过 `<script type="module">` 引入了 `editor/editor.js`，启动新功能。

## 3. 核心技术实现

-   **前端框架/库**:
    -   **Vanilla JavaScript (ES6 Modules)**: 用于组织代码，实现模块化。
    -   **Konva.js**: 用于构建高性能的交互式HTML5 Canvas画布。

-   **工作流程**:
    1.  用户在 `index.html` 上传图片。
    2.  `editor.js` 捕获事件，调用 `canvas.js` 中的